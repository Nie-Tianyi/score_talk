## 一、系统简介

这是一个移动端 APP，主要有两个核心功能模块：

1. **帖子社区模块**：类似贴吧/论坛，用户可以发帖、跟帖、评论。
2. **主题打分模块**：所有用户围绕某个“主题”进行打分并留下一条简短评论，如：

   > 主题：孙笑川
   > 用户 A：1 分，天皇陛下 desu！
   > 主题平均分：1.73 分

这是数据库课程的期末项目，重点在于：**数据要怎么存、有哪些实体和操作、需要满足哪些约束**。

---

## 二、主要参与角色

* 普通用户（已注册）
* 未登录用户（游客）
* 管理员（可选，用来做简单的内容管理）

---

## 三、功能性需求（Functional Requirements）

### 1. 用户与账户相关

1. **用户注册**

   * 用户可以通过手机号 / 邮箱 / 用户名注册账号。
   * 需要设置昵称、密码等基本信息。
   * 数据库存储：`User(id, username, password_hash, nickname, created_at, ...)`

2. **用户登录 / 登出**

   * 用户通过账号+密码登录。
   * 登录后才能发帖、评论、打分。
   * 游客可以浏览内容，但不能进行需要身份的操作。

3. **用户资料管理（简单版）**

   * 用户可以修改昵称、头像、个人简介。
   * （数据库上体现为对 User 表的更新）

---

### 2. 帖子社区模块

1. **板块 / 话题分类（可简单）**

   * 可选：可以有“板块”概念，比如「综合区」「吐槽区」。
   * 一个帖子属于一个板块。
   * `Board(id, name, description, ...)`（如果你们嫌麻烦，可以直接省略板块，用“全部帖子”）

2. **发帖**

   * 已登录用户可以新建帖子：

     * 标题
     * 正文内容
     * 所属板块（可选）
   * 数据库：

     ```text
     Post(id, user_id, title, content, board_id, created_at, updated_at, ...)
     ```

3. **查看帖子列表**

   * 按时间倒序查看帖子列表。
   * 支持简单分页（如每页 20 条）。
   * 可按板块过滤（如有板块）。

4. **查看帖子详情**

   * 包含：

     * 帖子内容
     * 发帖用户信息（昵称等）
     * 跟帖 / 评论列表

5. **跟帖 / 评论**

   * 用户可以对某一帖子发表评论。
   * 简化设计：评论只有一层，不支持“评论的评论”；如果想做楼中楼，可以设计 `parent_comment_id`。
   * `Comment(id, post_id, user_id, content, created_at, parent_comment_id NULLABLE, ...)`

6. **点赞/点踩（可选）**

   * 用户可以对帖子或评论点赞。
   * 每个用户对同一帖子/评论只能点一次赞。
   * 数据库可以有：

     ```text
     PostLike(id, post_id, user_id, created_at)
     CommentLike(id, comment_id, user_id, created_at)
     ```

7. **帖子/评论的简单管理**

   * 发帖人可以删除自己的帖子或评论（逻辑删除）。
   * 管理员可以删除不合规内容。
   * 数据库可以加 `is_deleted` 字段。

---

### 3. 主题打分模块

这里是你们项目的**特色功能**，重点可以在报告里多写一点。

1. **主题管理**

   * 一个“主题”就是一个可以被用户打分的对象。
   * 例：`主题：孙笑川`
   * 字段示例：

     ```text
     Topic(id, name, description, created_at, ...)
     ```
   * 主题可能由管理员创建，也可以开放给用户发起（但要考虑防垃圾，可以一开始先设计为管理员创建）。

2. **用户打分 + 简短评论**

   * 对每个主题，用户可以打一个分数，例如 1–5 分（你们自行规定）。
   * 同时可以写一条简短评论（比如限制 50 字或 100 字以内）。
   * **约束**：同一用户对同一主题**只能打一次分**，如果再次打分则视为更新他的评分和评论。
   * 数据表设计：

     ```text
     TopicRating(
       id,
       topic_id,
       user_id,
       score,         -- 如 1~5
       comment,       -- 简短文字
       created_at,
       updated_at
     )
     ```
   * 数据库层面可以加唯一约束：

     ```text
     UNIQUE(topic_id, user_id)
     ```

     保证一人一主题最多一条评分。

3. **查看主题平均分**

   * 每个主题都有一个平均分：

     * 例如：孙笑川 平均分 1.73 分。
   * 实现方式（数据库角度可以写两种）：

     1. **实时计算**：每次查询用 `AVG(score)` 聚合 `TopicRating`。
     2. **冗余存储**：在 `Topic` 表加 `avg_score` 和 `rating_count`，每次有评分增删改时更新这两个字段。
   * 对于课程项目，说明你们选择哪种，并解释利弊：

     * 实时计算：实现简单、数据不会不一致，但查询频繁时有性能压力。
     * 冗余存储：查询快，但要小心保持一致性。

4. **查看某个主题的评分详情**

   * 展示：

     * 主题信息（名称、说明）
     * 平均分、总评分人数
     * 每条评分：用户昵称、分数、简短评论、时间
   * 支持分页，防止一次查太多。

5. **热门主题 / 评分榜单（可选）**

   * 按评分人数排序，显示“最热门的主题”。
   * 或按平均分排序，显示“评分最高/最低的主题”。

---

### 4. 管理/维护功能（简单）

1. **管理员登录**

   * 管理员有单独账户或在 User 表里加一个 `role` 字段。

2. **内容审核**

   * 可以查看所有帖子、评论、评分评论。
   * 可以删除违规内容（逻辑删除）。

3. **主题管理**

   * 管理员可以创建、修改、删除主题。

---

## 四、非功能性需求（Non-Functional Requirements）

因为是课程项目，可以写得简单一点，但要覆盖关键点：**性能、可靠性、可维护性、可用性、安全性**等。

### 1. 性能与响应时间

* 在数据量较小时（例如帖子 < 1 万，评分 < 1 万），常用操作（浏览帖子列表、查看主题评分）应在**1–2 秒内返回**。
* 采用分页查询，避免一次性查询太多数据。
* 对访问频繁的字段添加索引，例如：

  * `Post(board_id, created_at)`
  * `Comment(post_id, created_at)`
  * `TopicRating(topic_id, user_id)`
  * `TopicRating(topic_id, score)`

### 2. 可用性与易用性

* UI 简单直观：

  * 帖子列表、帖子详情、主题评分列表布局清晰。
  * 打分操作流程尽量一步到位：选择分数 + 填一句话 + 提交。
* 对错误给出清晰提示：

  * 如“请先登录后再打分”“评论内容不能为空”。

### 3. 数据一致性与完整性（数据库重点）

* 使用主键、外键保证数据关系：

  * `Post.user_id` → `User.id`
  * `Comment.post_id` → `Post.id`
  * `TopicRating.topic_id` → `Topic.id`
  * `TopicRating.user_id` → `User.id`
* 使用约束保证数据合法：

  * 分数范围约束：`score BETWEEN 1 AND 5`
  * 一人一主题一评分：`UNIQUE(topic_id, user_id)`
* 对可能需要同时更新多表的操作（如更新评分、更新主题平均分），使用事务保证原子性。

### 4. 安全性

* 用户密码使用散列存储（如 `password_hash`），不以明文存储。
* 基础的输入校验与过滤：

  * 防止 SQL 注入：使用预编译语句。
  * 对用户输入的文本做长度限制，避免过长数据。
* 简单的权限控制：

  * 只有登录用户可以发帖、评论、打分。
  * 只有作者或管理员可以删除自己的内容。

### 5. 可扩展性与可维护性

* 数据库设计要留一点余地：

  * 例如 `Topic` 表可以以后加“封面图”、“标签”等字段。
  * `Post` 以后可以加“图片 URL”、“话题标签”等。
* 模块化：

  * 帖子模块、评分模块在逻辑上相对独立，方便以后单独扩展。

### 6. 可靠性与备份（课程级别简单写）

* 定期备份数据库（比如每天/每周一次）。
* 对删除采用“逻辑删除”（加 `is_deleted` 字段），降低误删风险。

---

## 五、小结

本 APP 的核心特点在于将**传统帖子社区**与**围绕特定主题的打分+短评机制**结合起来。
数据库设计需要重点支持以下几方面：

1. 用户、帖子、评论的基本 CRUD 操作。
2. 主题与用户评分的一对多关系，以及“一人一主题一评分”的约束。
3. 主题平均分等统计信息的高效查询与一致性维护。

这些功能性和非功能性需求能够覆盖数据库课程对“实体建模、约束设计、事务与一致性、简单性能优化”等方面的要求，同时整体系统不会过于复杂，适合作为期末小组项目。

---
